define(["require","jquery","underscore","monster","chart"],function(e){var t=e("jquery"),n=e("underscore"),r=e("monster"),i=e("chart"),s={requests:{},subscribe:{"voip.featureCodes.render":"featureCodesRender"},categories:{call_forward:["call_forward[action=activate]","call_forward[action=deactivate]","call_forward[action=toggle]","call_forward[action=update]","call_forward[action=on_busy_enable]","call_forward[action=on_busy_disable]","call_forward[action=no_answer_enable]","call_forward[action=no_answer_disable]"],hotdesk:["hotdesk[action=login]","hotdesk[action=logout]","hotdesk[action=toggle]"],parking:["park_and_retrieve","valet","retrieve"],do_not_disturb:['donotdisturb[action="enable"]','donotdisturb[action="disable"]','donotdisturb[action="toggle"]'],misc:["voicemail[action=check]",'voicemail[action="direct"]',"intercom","privacy[mode=full]","directory","time","call_waiting[action=enable]","call_waiting[action=disable]","sound_test_service","call_recording"]},featureCodesRender:function(e){var n=this,i=e.parent||t(".right-content"),s=e.callback;n.featureCodesLoadData(function(e){var o=t(r.template(n,"featureCodes-layout",{featureCodes:n.featureCodesFormatData(e)}));n.featureCodesBindEvents({parent:i,template:o,featureCodes:e}),i.empty().append(o),s&&s()})},featureCodesLoadData:function(e){var t=this;t.callApi({resource:"callflow.list",data:{accountId:t.accountId,filters:{has_key:"featurecode"}},success:function(t,n){e&&e(t.data)}})},featureCodesFormatData:function(e){var i=this,s={};return n.each(e,function(e){if(e.featurecode.hasOwnProperty("name")){var t="misc";n.find(i.categories,function(n,r){return n.indexOf(e.featurecode.name)>=0?(t=r,!0):!1}),s.hasOwnProperty(t)||(s[t]={category:i.i18n.active().featureCodes.categories[t],codes:[]}),s[t].codes.push({key:e.featurecode.name,name:i.i18n.active().featureCodes.labels[e.featurecode.name]||e.featurecode.name,number:e.featurecode.number?e.featurecode.number.replace(/\\/g,""):""})}}),r.util.sort(t.map(s,function(e){return r.util.sort(e.codes,"number"),e}),"category")},featureCodesBindEvents:function(e){var t=this,n=e.parent,i=e.template,s=e.featureCodes;i.find(".main-number-link").on("click",function(e){e.preventDefault();var t=n.parents("#voip_container").find(".left-menu");t.find(".category").removeClass("active"),t.find(".category#strategy").addClass("active"),n.empty(),r.pub("voip.strategy.render",{parent:n})})}};return s});