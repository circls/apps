define(["require","jquery","underscore","monster","toastr"],function(e){var t=e("jquery"),n=e("underscore"),r=e("monster"),i=e("toastr"),s={requests:{},subscribe:{"common.carrierSelector":"carrierSelectorRender","common.carrierSelector.getDescription":"carrierSelectorGetDescription"},carrierSelectorRender:function(e){var n=this,i=n.carrierSelectorFormatData(e.data),s=t(r.template(n,"carrierSelector-layout",i));n.carrierSelectorBindEvents(s,i,e.callbackAfterSave),e.container.empty().append(s)},carrierSelectorFormatData:function(e){var t=this,i=t.i18n.active().carrierSelector.useReseller.defaultFriendlyName,s=t.i18n.active().carrierSelector.useReseller.defaultHelp;r.config.whitelabel.hasOwnProperty("companyName")&&(i=r.template(t,"!"+t.i18n.active().carrierSelector.useReseller.friendlyName,{variable:r.config.whitelabel.companyName}),s=r.template(t,"!"+t.i18n.active().carrierSelector.useReseller.help,{variable:r.config.whitelabel.companyName}));var o={noMatchCallflow:e.noMatch,type:"useBlended",choices:[{friendlyName:t.i18n.active().carrierSelector.useBlended.friendlyName,help:t.i18n.active().carrierSelector.useBlended.help,value:"useBlended"},{friendlyName:i,help:s,value:"useReseller"},{friendlyName:t.i18n.active().carrierSelector.byoc.friendlyName,help:t.i18n.active().carrierSelector.byoc.help,value:"byoc"}]};if(r.config.whitelabel.hasOwnProperty("carrier")){var u=[],a={};n.each(o.choices,function(e){a[e.value]=e}),n.each(r.config.whitelabel.carrier.choices,function(e){u.push(a[e])}),o.choices=u}return o.choices.length===1&&(o.disabled=!0),e.noMatch.flow.module==="offnet"?o.type="useBlended":e.noMatch.flow.module==="resources"&&(e.noMatch.flow.data.hasOwnProperty("hunt_account_id")?e.noMatch.flow.data.hunt_account_id===e.accountData.id?o.type="byoc":e.noMatch.flow.data.hunt_account_id===e.accountData.reseller_id?o.type="useReseller":(o.huntError="wrong_hunt_id",o.type="useBlended"):o.type="byoc"),e.carrierInfo=o,e},carrierSelectorBindEvents:function(e,n,s){var o=this,u=e,a=n.carrierInfo.type,f=n.accountData.id,l=n.accountData.reseller_id,c=n.noMatch;r.ui.tooltips(u),u.find(".carrier-choice").on("click",function(){var e=t(this),n=u.find(".carrier-save");u.find(".carrier-choice").removeClass("selected"),e.addClass("selected"),e.data("type")!==a?n.removeClass("disabled"):n.addClass("disabled")}),u.find(".carrier-save").on("click",function(){var e=t(this),n=u.find(".carrier-choice.selected").data("type");if(n!==a){var r=function(t){a=n,i.success(o.i18n.active().carrierSelector.saveSuccess),u.find(".hunt-error").remove(),e.addClass("disabled"),s&&s(t)},h={type:n,accountId:f,resellerId:l};c.hasOwnProperty("id")?(h.callflowId=c.id,o.carrierSelectorUpdateNoMatch(h,r)):o.carrierSelectorCreateNoMatch(h,r)}})},carrierSelectorCreateNoMatch:function(e,t){var n=this,i=r.config.whitelabel.hasOwnProperty("carrier")?r.config.whitelabel.carrier.choices[0]:!1,s=e.type||i||"useBlended",o=e.accountId,u=e.resellerId,a=n.carrierSelectorGetDataNoMatch(s,u);n.callApi({resource:"callflow.create",data:{accountId:o,data:a},success:function(e,n){t(e.data)}})},carrierSelectorUpdateNoMatch:function(e,t){var n=this,r=e.type,i=e.accountId,s=e.callflowId,o=e.resellerId,u=n.carrierSelectorGetDataNoMatch(r,o);n.callApi({resource:"callflow.update",data:{accountId:i,callflowId:s,data:u},success:function(e,n){t(e.data)}})},carrierSelectorGetDataNoMatch:function(e,t){var n=this,r={numbers:["no_match"],flow:{children:{},data:{},module:"offnet"}};return e!=="useBlended"&&(r.flow.module="resources",e==="useReseller"&&(r.flow.data.hunt_account_id=t)),r},carrierSelectorGetDescription:function(e){var t=this,n=e.data,i=e.callback,s="",o="";n.noMatch.flow.module==="offnet"?s="useBlended":n.noMatch.flow.module==="resources"&&(n.noMatch.flow.data.hasOwnProperty("hunt_account_id")?n.noMatch.flow.data.hunt_account_id===n.accountData.id?s="byoc":n.noMatch.flow.data.hunt_account_id===n.accountData.reseller_id?s="useReseller":s="useBlended":s="byoc"),r.config.whitelabel.hasOwnProperty("companyName")&&s==="useReseller"?o=r.template(t,"!"+t.i18n.active().carrierSelector.useReseller.friendlyName,{variable:r.config.whitelabel.companyName}):o=t.i18n.active().carrierSelector[s].friendlyName,i&&i(o)}};return s});