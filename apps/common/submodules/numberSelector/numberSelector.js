define(["require","jquery","underscore","monster"],function(e){var t=e("jquery"),n=e("underscore"),r=e("monster"),i={requests:{},subscribe:{"common.numberSelector.render":"numberSelectorRender"},numberSelectorRender:function(e){var n=this,i=e.container,s=t.extend({empty:n.i18n.active().numberSelector.emptyValue,remove:n.i18n.active().numberSelector.removeLink,spare:n.i18n.active().numberSelector.spareLink,buy:n.i18n.active().numberSelector.buyLink,hideNumber:!1},e.labels),o=t(r.template(n,"numberSelector-layout",{labels:s,inputName:e.inputName||"",number:e.number,noSpare:e.noSpare===!0?!0:!1,noBuy:e.noBuy===!0?!0:!1}));if(!i)throw"A container must be provided.";e.labels=s,n.numberSelectorBindEvents(t.extend({template:o},e)),i.append(o)},numberSelectorBindEvents:function(e){var i=this,s=e.template,o=e.removeCallback,u=e.spareCallback,a=e.buyCallback,f=e.globalAddNumberCallback,l=e.spareFilters,c=e.customNumbers,h=s.find(".number-selector-dropdown"),p=s.find(".number-selector-input"),d=s.find(".number-selector-displayed .number"),v=s.find(".remove-element"),m=function(e){p.val(e),d.text(r.util.formatPhoneNumber(e)),v.find(".number").text(r.util.formatPhoneNumber(e)),v.removeClass("hidden")},g=function(e){if(e&&!n.isEmpty(e)){var t=n.isArray(e)?e[0].phoneNumber:Object.keys(e)[0];m(t),f?f(t):u&&u(t)}};h.on("click",function(){h.toggleClass("open")}),h.on("blur",function(){h.removeClass("open")}),s.find(".number-selector-element").on("click",function(){switch(t(this).data("action")){case"remove":var n=p.val();p.val(""),d.text(e.labels.empty),v.addClass("hidden"),o&&o(n);break;case"spare":c?r.pub("common.monsterListing.render",{dataList:c,dataType:"numbers",singleSelect:!0,okCallback:g}):r.pub("common.numbers.dialogSpare",{accountName:r.apps.auth.currentAccount.name,accountId:i.accountId,featureFilters:l,singleSelect:!0,callback:g});break;case"buy":r.pub("common.buyNumbers",{accountId:i.accountId,searchType:"regular",callbacks:{success:function(e){f?f(e,m):a(e)}}})}})}};return i});