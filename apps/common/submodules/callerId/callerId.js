define(["require","jquery","underscore","monster","toastr"],function(e){var t=e("jquery"),n=e("underscore"),r=e("monster"),i=e("toastr"),s={requests:{},subscribe:{"common.callerId.renderPopup":"callerIdEdit"},callerIdRender:function(e,s){var o=this,u=t(r.template(o,"callerId-layout",e.cnam||{})),a,f=u.find("#cnam");r.ui.validate(f,{rules:{display_name:{minlength:1,maxlength:15}}}),u.find(".save").on("click",function(t){t.preventDefault();if(r.ui.valid(f)){var u=r.ui.getFormData("cnam");n.extend(e,{cnam:u}),u.display_name===""&&delete e.cnam.display_name,o.callerIdUpdateNumber(e.id,e,function(e){var t=r.util.formatPhoneNumber(e.data.id),n=r.template(o,"!"+o.i18n.active().callerId.successCnam,{phoneNumber:t});i.success(n),a.dialog("destroy").remove(),s.success&&s.success(e)},function(e){s.error&&s.error(e)})}}),u.find(".cancel-link").on("click",function(e){e.preventDefault(),a.dialog("destroy").remove()}),a=r.ui.dialog(u,{title:o.i18n.active().callerId.dialogTitle})},callerIdEdit:function(e){var t=this;t.callerIdGetNumber(e.phoneNumber,function(n){t.callerIdRender(n.data,e.callbacks)})},callerIdGetNumber:function(e,t,n){var r=this;r.callApi({resource:"numbers.get",data:{accountId:r.accountId,phoneNumber:encodeURIComponent(e)},success:function(e,n){typeof t=="function"&&t(e)},error:function(e,t){typeof n=="function"&&n(e)}})},callerIdUpdateNumber:function(e,t,n,r){var i=this;i.callApi({resource:"numbers.update",data:{accountId:i.accountId,phoneNumber:encodeURIComponent(e),data:t},success:function(e,t){typeof n=="function"&&n(e)},error:function(e,t){typeof r=="function"&&r(e)}})}};return s});