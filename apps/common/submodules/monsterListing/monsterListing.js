define(["require","jquery","underscore","monster"],function(e){var t=e("jquery"),n=e("underscore"),r=e("monster"),i={requests:{},subscribe:{"common.monsterListing.render":"monsterListingRender"},monsterListingRender:function(e){var n=this,i=e.container,s=n.monsterListingFormatData(e),o=t(r.template(n,"monsterListing-layout",s.labels)),u;o.find(".grid-content").append(r.template(n,s.templateName,s)),r.ui.tooltips(o,{options:{container:"body"}}),o.find(".empty-search-row").hide(),i?i.empty().append(o):u=r.ui.dialog(o,{title:s.labels.title,position:["center",20]}),n.monsterListingBindEvents(t.extend({},e,{template:o,popup:u,formattedData:s}))},monsterListingFormatData:function(e){var i=this,s=e.dataType,o={dataList:e.dataList,singleSelect:e.singleSelect};switch(s){case"numbers":o.sortedDataList=n.map(e.dataList,function(e,t){return e.phoneNumber=t,e}),r.util.sort(o.sortedDataList,"phoneNumber"),o.templateName="monsterListing-numbers";break;case"users":o.sortedDataList=n.map(e.dataList,function(e,t){return e.name=e.first_name+" "+e.last_name,e}),n.isArray(e.dataList)&&(o.dataList=n.indexBy(e.dataList,"id")),r.util.sort(o.sortedDataList),o.templateName="monsterListing-default";break;default:n.isArray(e.dataList)?(o.sortedDataList=e.dataList,o.dataList=n.indexBy(e.dataList,"id")):o.sortedDataList=n.toArray(e.dataList),r.util.sort(o.sortedDataList),o.templateName="monsterListing-default"}return s in i.i18n.active().monsterListing?o.labels=t.extend({},i.i18n.active().monsterListing[s],e.labels):o.labels=t.extend({},i.i18n.active().monsterListing["default"],e.labels),o.labels.headline=e.singleSelect?o.labels.headlineSingle:o.labels.headline,o},monsterListingBindEvents:function(e){var i=this,s=e.template,o=e.popup,u=e.formattedData,a=u.sortedDataList,f=u.dataList,l=e.cancelCallback,c=e.okCallback;s.on("keyup",".search-query",function(){var e=s.find(".monster-listing-box"),r=s.find(".empty-search-row"),i;currentSearch=t(this).val().toLowerCase(),n.each(e,function(e){i=t(e),i.data("search").toLowerCase().indexOf(currentSearch)<0?i.hide():i.show()}),e.size()>0&&(e.is(":visible")?r.hide():r.show())}),s.find(".monster-listing-box:not(.no-data)").on("click",function(e){var n=t(this);if(!t(e.target).is("input, .monster-checkbox, .monster-checkbox > *")){var r=n.find("input"),i=r.prop("checked");r.prop("checked",!i).change()}}),s.find(".monster-listing-box:not(.no-data) input").on("change",function(n){e.singleSelect?(s.find(".monster-listing-box").removeClass("selected"),t(this).parents(".monster-listing-box").addClass("selected")):t(this).parents(".monster-listing-box").toggleClass("selected")}),s.find(".proceed").on("click",function(){var e=s.find(".monster-listing-box.selected"),i=a.length-e.length,l=[];n.each(e,function(e){var n=t(e).data("id");l.push(f.hasOwnProperty(n)?f[n]:n)}),l.length>0?(c&&c(l,i),o&&o.dialog("close").remove()):r.ui.alert("error",u.labels.noDataSelected)}),s.find(".cancel").on("click",function(e){o&&o.dialog("close").remove(),l&&l()})}};return i});