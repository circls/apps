define(["require","jquery","underscore","monster"],function(e){var t=e("jquery"),n=e("underscore"),r=e("monster"),i={requests:{},subscribe:{"myaccount.trunks.renderContent":"_trunksRenderContent","myaccount.refreshBadges":"_trunksRefreshBadges"},_trunksRenderContent:function(e){var t=this;e.key==="inbound"?t.trunksRenderInbound(e.callback):e.key==="outbound"?t.trunksRenderOutbound(e.callback):e.key==="twoway"&&t.trunksRenderTwoway(e.callback)},_trunksRefreshBadges:function(e){var t=this;(!e.hasOwnProperty("except")||e.except!=="trunks")&&t.trunksGetLimits(function(t){var n={module:"trunks",key:"inbound",data:t.data.inbound_trunks||0,callback:e.callback},i={module:"trunks",key:"outbound",data:t.data.outbound_trunks||0,callback:e.callback},s={module:"trunks",key:"twoway",data:t.data.twoway_trunks||0,callback:e.callback};r.pub("myaccount.updateMenu",n),r.pub("myaccount.updateMenu",i),r.pub("myaccount.updateMenu",s)})},trunksRenderInbound:function(e){var n=this;n.trunksGetLimits(function(i){var s=6.99,o=i.data.inbound_trunks||0,u=s*o,a={inbound:o,amountInbound:s.toFixed(2),totalAmountInbound:u.toFixed(2)},f=t(r.template(n,"trunks-inbound",a));r.ui.tooltips(f),f.find("#slider_inbound").slider({min:0,max:100,range:"min",value:i.data.inbound_trunks>0?i.data.inbound_trunks:0,slide:function(e,t){f.find(".slider-value").html(t.value),u=t.value*s,f.find(".total-amount .total-amount-value").html(u.toFixed(2)),f.find(".slider-value").css("left",f.find("#slider_inbound .ui-slider-handle").css("left"))},change:function(e,t){f.find(".slider-value").css("left",f.find("#slider_inbound .ui-slider-handle").css("left"))}}),f.find(".update-limits").on("click",function(e){e.preventDefault(),n.trunksGetLimits(function(e){var s={inbound_trunks:f.find("#slider_inbound").slider("value"),twoway_trunks:"data"in i?i.data.twoway_trunks||0:0};s=t.extend(!0,e.data,s),n.trunksUpdateLimits(s,function(e){var t={module:n.name,key:"inbound",data:s.inbound_trunks};r.pub("myaccount.updateMenu",t),n.trunksRenderInbound()})})}),r.pub("myaccount.renderSubmodule",f),f.find(".slider-value").css("left",f.find("#slider_inbound .ui-slider-handle").css("left")),e&&e()})},trunksRenderOutbound:function(e){var n=this;n.trunksGetLimits(function(i){var s=29.99,o=i.data.outbound_trunks||0,u=s*o,a={outbound:o,amountOutbound:s.toFixed(2),totalAmountOutbound:u.toFixed(2)},f=t(r.template(n,"trunks-outbound",a));r.ui.tooltips(f),f.find("#slider_outbound").slider({min:0,max:100,range:"min",value:i.data.outbound_trunks>0?i.data.outbound_trunks:0,slide:function(e,t){f.find(".slider-value").html(t.value),u=t.value*s,f.find(".total-amount .total-amount-value").html(u.toFixed(2)),f.find(".slider-value").css("left",f.find("#slider_outbound .ui-slider-handle").css("left"))},change:function(e,t){f.find(".slider-value").css("left",f.find("#slider_outbound .ui-slider-handle").css("left"))}}),f.find(".update-limits").on("click",function(e){e.preventDefault(),n.trunksGetLimits(function(e){var s={outbound_trunks:f.find("#slider_outbound").slider("value"),inbound_trunks:"data"in i?i.data.inbound_trunks||0:0,twoway_trunks:"data"in i?i.data.twoway_trunks||0:0};s=t.extend(!0,e.data,s),n.trunksUpdateLimits(s,function(e){var t={module:n.name,data:s.outbound_trunks,key:"outbound"};r.pub("myaccount.updateMenu",t),n.trunksRenderOutbound()})})}),r.pub("myaccount.renderSubmodule",f),f.find(".slider-value").css("left",f.find("#slider_outbound .ui-slider-handle").css("left")),e&&e()})},trunksRenderTwoway:function(e){var n=this;n.trunksGetLimits(function(i){var s=29.99,o=i.data.twoway_trunks||0,u=s*o,a={twoway:o,amountTwoway:s.toFixed(2),totalAmountTwoway:u.toFixed(2)},f=t(r.template(n,"trunks-twoway",a));r.ui.tooltips(f),f.find("#slider_twoway").slider({min:0,max:100,range:"min",value:i.data.twoway_trunks>0?i.data.twoway_trunks:0,slide:function(e,t){f.find(".slider-value").html(t.value),u=t.value*s,f.find(".total-amount .total-amount-value").html(u.toFixed(2)),f.find(".slider-value").css("left",f.find("#slider_twoway .ui-slider-handle").css("left"))},change:function(e,t){f.find(".slider-value").css("left",f.find("#slider_twoway .ui-slider-handle").css("left"))}}),f.find(".update-limits").on("click",function(e){e.preventDefault(),n.trunksGetLimits(function(e){var s={twoway_trunks:f.find("#slider_twoway").slider("value"),inbound_trunks:"data"in i?i.data.inbound_trunks||0:0};s=t.extend(!0,e.data,s),n.trunksUpdateLimits(s,function(e){var t={module:n.name,data:s.twoway_trunks,key:"twoway"};r.pub("myaccount.updateMenu",t),n.trunksRenderTwoway()})})}),r.pub("myaccount.renderSubmodule",f),f.find(".slider-value").css("left",f.find("#slider_twoway .ui-slider-handle").css("left")),e&&e()})},trunksGetLimits:function(e,t){var n=this;n.callApi({resource:"limits.get",data:{accountId:n.accountId},success:function(t,n){e&&e(t,n)},error:function(e,n){t&&t(e,n)}})},trunksUpdateLimits:function(e,t,n){var r=this;r.callApi({resource:"limits.update",data:{accountId:r.accountId,data:e},success:function(e,n){t&&t(e,n)},error:function(e,t){n&&n(e,t)}})}};return i});